# zsh-prompt-engine

Build a dynamic ZSH prompt with ASCII art, lightweight animations, and contextual data. The engine is modular (git, system metrics, project context, art) and reads a small TOML/YAML config.

## Quick start

- Prerequisites: `zsh`, `python3`, `git` (for the git module), and optionally `pyyaml` if you want YAML configs (`pip install -r requirements.txt`).
- Clone this repo and point your shell at the init script:

  ```zsh
  # ~/.zshrc
  source /path/to/zsh-prompt-engine/bin/zpe-init.zsh
  ```

- Optionally set a custom config path before sourcing: `export ZPE_CONFIG_PATH=$HOME/.config/zpe.toml`.
- Optional: set `ZPE_CACHE_DIR` to control where parsed config payloads are cached (default: `~/.cache/zpe`).

## What you get

- Modular prompt builder with per-module enable/disable and ordering.
- Git summary: branch + added/modified/deleted counts (from `git status --porcelain`).
- System info: time + 1-minute load average.
- Project context: current directory name.
- Kubernetes context + namespace (optional).
- Python venv / conda env indicator.
- Battery level (Linux, `/sys/class/power_supply` or `acpi`).
- ASCII art + simple frame-based animation.

## Configuration

Default config lives in `config/default.toml`. Copy it somewhere (e.g., `~/.config/zpe.toml`) and tweak:

```toml
[prompt]
separator = " | "
enable_animation = true
frame_interval = 1  # number of prompts between frame advances

[modules]
order = ["art", "project", "git", "system", "kubectl", "venv", "battery"]

[git]
show_branch = true
show_status = true

[system]
show_time = true
show_load = true

[colors]
primary = "cyan"
muted = "white"
accent = "magenta"

[art]
frames = ["<o", "o>", "^o", "o^"]

[kubectl]
show_namespace = true

[venv]
show_prefix = true

[battery]
show_status = true
```

YAML works too if `pyyaml` is installed.

## Module behavior

- `art`: cycles through configured frames; set `enable_animation=false` to freeze on the first frame.
- `project`: shows the current directory name.
- `git`: only renders inside git repos; shows branch and dirty counters when enabled.
- `system`: renders time and load average when enabled.
- `kubectl`: shows `kubectl config current-context`, optionally namespace via `kubectl config view --minify`; requires `kubectl` on PATH.
- `venv`: shows Python virtualenv or conda env if active.
- `battery`: shows percent (and +/=/âˆ’ when `show_status=true`) using `/sys/class/power_supply` or `acpi`.

## Extending

- Add a new module file under `modules/your_module.zsh` that returns a short string.
- Register it in `zpe_register_default_modules` inside `src/zpe.zsh` and add it to `modules.order` in your config.

## Troubleshooting

- If the prompt looks uncolored, ensure `autoload -U colors && colors` succeeds in your shell.
- If YAML parsing fails, install `pyyaml` or switch to TOML. Errors from the loader are printed with a `zpe:` prefix.
