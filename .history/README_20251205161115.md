# zsh-prompt-engine

Build a dynamic ZSH prompt with ASCII art, lightweight animations, and contextual data. The engine is modular (git, system metrics, project context, kubectl, venv, battery, art) and reads a small TOML/YAML config.

## Quick start

**Prerequisites:** `zsh`, `python3`, `git` (for the git module), and optionally `pyyaml` for YAML configs.

### Install via Makefile (recommended)

```bash
git clone https://github.com/Querulantenkind/zsh-prompt-engine.git
cd zsh-prompt-engine
make install   # symlinks to ~/.local/bin and adds source line to ~/.zshrc
```

Or use the install script directly:

```bash
./install.sh             # full install
./install.sh --link-only # symlink only, no ~/.zshrc modification
./install.sh --uninstall # remove symlink and ~/.zshrc line
```

### Manual setup

Add to your `~/.zshrc`:

```zsh
# Optional overrides
# export ZPE_CONFIG_PATH="$HOME/.config/zpe.toml"
# export ZPE_CACHE_DIR="$HOME/.cache/zpe"

source /path/to/zsh-prompt-engine/bin/zpe-init.zsh
```

A minimal `setup.zsh` snippet is also provided for reference.

## What you get

- Modular prompt builder with per-module `enabled` flag and `modules.disabled` list.
- **git:** branch (with optional truncation) + added/modified/deleted counts.
- **system:** time + 1-minute load average.
- **project:** current directory name (with optional truncation).
- **kubectl:** Kubernetes context + namespace.
- **venv:** Python virtualenv or conda env indicator.
- **battery:** percent with color thresholds (warn/critical) and charge state icon.
- **art:** ASCII art frames with simple animation.

## Configuration

Default config lives in `config/default.toml`. Copy it (e.g., `~/.config/zpe.toml`) and tweak:

```toml
[prompt]
separator = " | "
enable_animation = true
frame_interval = 1  # prompts between frame advances

[modules]
order = ["art", "project", "git", "system", "kubectl", "venv", "battery"]
disabled = []  # e.g. ["battery", "kubectl"] to quickly disable

[git]
enabled = true
show_branch = true
show_status = true
max_branch_len = 0  # 0 = no truncation

[system]
enabled = true
show_time = true
show_load = true

[colors]
primary = "cyan"
muted = "white"
accent = "magenta"

[art]
enabled = true
frames = ["<o", "o>", "^o", "o^"]

[kubectl]
enabled = true
show_namespace = true

[venv]
enabled = true
show_prefix = true

[project]
enabled = true
max_path_len = 0  # 0 = no truncation

[battery]
enabled = true
show_status = true
warn_threshold = 20
critical_threshold = 10
```

YAML works too if `pyyaml` is installed.

## Module behavior

| Module   | Description |
|----------|-------------|
| `art`    | Cycles through configured frames; set `enable_animation=false` to freeze. |
| `project`| Shows current directory name; truncates from left if `max_path_len > 0`. |
| `git`    | Branch + dirty counts; truncates branch if `max_branch_len > 0`. |
| `system` | Time + load average. |
| `kubectl`| Context + namespace (requires `kubectl` on PATH). |
| `venv`   | Shows active virtualenv or conda env. |
| `battery`| Percent + icon; yellow below `warn_threshold`, red below `critical_threshold`. |

## Extending

1. Create `modules/your_module.zsh` with a function that prints a short string.
2. Register it in `zpe_register_default_modules` (`src/zpe.zsh`).
3. Add `your_module` to `modules.order` in your config.

## Running tests

```bash
make test
# or
python -m unittest discover tests
```

## Troubleshooting

- **Uncolored prompt:** Ensure `autoload -U colors && colors` succeeds.
- **YAML errors:** Install `pyyaml` or use TOML. Loader errors are prefixed with `zpe:`.
- **kubectl/battery not showing:** Verify the tool is on PATH and the module is enabled.
- **Cache issues:** Delete `~/.cache/zpe` to force config re-parse.
